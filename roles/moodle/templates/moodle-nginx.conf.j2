location ^/moodle {
    alias {{ moodle_base }};
    try_files $uri $uri/ index.php =404;
}

location /moodle/dataroot/ {
    internal;
    alias {{ moodle_data }};
}

location ~ /moodle/[^/]\.php(/|$) {
    include /etc/nginx/fastcgi_params;
    fastcgi_split_path_info ^(.+\.php)(/.+)$;
    fastcgi_read_timeout 300;
    fastcgi_pass php;
    fastcgi_index index.php;
    fastcgi_param   PATH_INFO        $fastcgi_path_info;
    fastcgi_param   SCRIPT_FILENAME    $fastcgi_script_name;
    fastcgi_param   PHP_VALUE "max_execution_time=300\n upload_max_filesize=500M\n post_max_size=500M\n max_input_vars=5000";
}
