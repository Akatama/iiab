# Local Add-ons

- name: ...IS BEGINNING ====================================
  command: echo

- name: INTERNETARCHIVE
  include_role:
    name: internetarchive
  when: internetarchive_install | bool
  #tags: internetarchive

# Is porting to Python 3 complete, and if so does this belong elsewhere?
- name: CAPTIVE PORTAL
  include_role:
    name: captiveportal
  #include_tasks: roles/captiveportal/tasks/main.yml
  when: captiveportal_install | bool
  #tags: base, captiveportal, network, domain

- name: MINETEST
  include_role:
    name: minetest
  when: minetest_install | bool
  #tags: minetest

# KEEP AT THE END as this installs dependencies from Debian's 'testing' branch!
- name: CALIBRE
  include_role:
    name: calibre
  when: calibre_install | bool
  #tags: calibre

- name: CALIBRE-WEB
  include_role:
    name: calibre-web
  when: calibreweb_install | bool
  #tags: calibre-web

# Could split these two below to Stage 10?

- name: Configure NGINX (already installed in Stage 3-BASE-SERVER)
  # If just CONFIGURING, should we use one of the following instead ??
  # include_tasks: roles/nginx/tasks/setup.yml
  # include_tasks: roles/nginx/tasks/enable.yml
  include_role:
    name: nginx
  when: nginx_install | bool
  #tags: base, nginx

- name: Configure Apache systemd service ({{ apache_service }})
  include_role:
    name: httpd-enable
  when: apache_install | bool
  #tags: base, httpd

- name: Recording STAGE 9 HAS COMPLETED ====================
  lineinfile:
    dest: "{{ iiab_env_file }}"
    regexp: '^STAGE=*'
    line: 'STAGE=9'
